#My bashrc for ssh

echo "Welcome Tim"


SSHRCD=$SSHHOME/.sshrc.d
VIM=$SSHHOME/.sshrc.d

# --------------------------------- aliases  ---------------------------------

#Make ip have colours
alias ip='ip -br -c'


#default python
alias python="/usr/bin/python3.9"

#better pip
alias pip="python3 -m pip"

alias temp='cd $(mktemp -d)'


#source bash
alias sb=". ~/.bashrc"
## Adds my own tmux and vim configs to the ssh'd system
alias vi=vim 
alias tmux="tmux -S /tmp/timtmux -f $SSHRCD/.tmux.conf"

# ------------------------------------ vim -----------------------------------

export VIMINIT="let \$MYVIMRC='$SSHHOME/.sshrc.d/.vimrc' | source \$MYVIMRC"

# ----------------------------------- tmux -----------------------------------

tmuxrc() {
    local TMUXDIR=/tmp/tmuxserver
    if ! [ -d $TMUXDIR ]; then
        rm -rf $TMUXDIR
        mkdir -p $TMUXDIR
    fi
    rm -rf $TMUXDIR/.sshrc.d
    cp -r $SSHHOME/.sshrc $SSHHOME/bashsshrc $SSHHOME/sshrc $SSHHOME/.sshrc.d $TMUXDIR
    SSHHOME=$TMUXDIR SHELL=$TMUXDIR/bashsshrc /usr/bin/tmux -S $TMUXDIR/tmuxserver -f $SSHHOME/.sshrc.d/.tmux.conf $@
}

# ---------------------------- bash shell options ----------------------------

shopt -s checkwinsize
#shopt -s expand_aliases
shopt -s globstar
shopt -s dotglob
shopt -s extglob
#shopt -s nullglob # bug kills completion for some
#set -o noclobber
shopt -s histappend


# ----------------------------------- pager ----------------------------------

if test -x /usr/bin/lesspipe; then
      export LESSOPEN="| /usr/bin/lesspipe %s";
        export LESSCLOSE="/usr/bin/lesspipe %s %s";
fi


export LESS_TERMCAP_mb=$(tput bold; tput setaf 2) # green
export LESS_TERMCAP_md=$(tput bold; tput setaf 6) # cyan
export LESS_TERMCAP_me=$(tput sgr0)
export LESS_TERMCAP_so=$(tput bold; tput setaf 3; tput setab 4) # yellow on blue
export LESS_TERMCAP_se=$(tput rmso; tput sgr0)
export LESS_TERMCAP_us=$(tput smul; tput bold; tput setaf 7) # white
export LESS_TERMCAP_ue=$(tput rmul; tput sgr0)
export LESS_TERMCAP_mr=$(tput rev)
export LESS_TERMCAP_mh=$(tput dim)
export LESS_TERMCAP_ZN=$(tput ssubm)
export LESS_TERMCAP_ZV=$(tput rsubm)
export LESS_TERMCAP_ZO=$(tput ssupm)
export LESS_TERMCAP_ZW=$(tput rsupm)
export GROFF_NO_SGR=1         # For Konsole and Gnome-terminal

PROMPT_LONG=20
PROMPT_MAX=95
PROMPT_AT=@
__ps1() {



  local DOCKER=/.dockerenv
  local P='$' dir="${PWD##*/}" B countme short long double\
    r='\[\e[31m\]' g='\[\e[30m\]' b='\[\e[34m\]' \
    y='\[\e[33m\]' p='\[\e[35m\]' w='\[\e[37m\]' \
    c='\[\e[36m\]' x='\[\e[0m\]'  gr='\[\e[32m\]' 

  
  #git branch in PS1 
  B=$(git branch --show-current 2>/dev/null)
  [[ $dir = "$B" ]] && B=. 

  #Check if in docker container PS1 

  if test -f "$DOCKER"; then
    docker="<docker>"
  fi  

  #Check if in venv PS1 
  if test -n "$VIRTUAL_ENV"; then
    venv="${VIRTUAL_ENV##*/}"
  else
    venv=""
  fi  

  countme="$doc$venv$USER$PROMPT_AT$(hostname):$dir($B)\$ "

  [[ $B = master || $B = main ]] && b="$r"
  


  test -n "$venv" && venv="$c($c$venv$c)"
  [[ -n "$B" ]] && B="$gr($c$B$gr)"
  doc=$gr$docker
  AT="$b$PROMPT_AT"
  dir="$w$dir"
  long_t="$gr╔ "
  double_pl="$gr║ "
  long_b="$gr╚ "
  sym="$p$P"

  short="$y\u$doc$venv$AT$h\h$g:$dir$B$sym$x "
  long="$long_t$y\u$doc$venv$AT$h\h$g:$dir$B\n$long_b$sym$x "
  double="$long_t$y\u$doc$venv$AT$h\h$g:$dir\n$double_pl$B\n$long_b$p$P$x "

  if (( ${#countme} > PROMPT_MAX )); then
    PS1="$double"
  elif (( ${#countme} > PROMPT_LONG )); then
    PS1="$long"
  else
    PS1="$short"
  fi  
}

PROMPT_COMMAND="__ps1"




export SHELL=`which bash`
